# CI/CD Tutorial(Huawei Cloud)

## 0. Overview

这是一份为软院SE2320课程（互联网产品设计与开发）编写的华为云CI/CD配置教程，记录了我配置华为云流水线的过程和踩过的一些坑。

从个人的观感上来说，华为云的CI/CD是真的很难用...不仅有一堆奇奇怪怪的图形化界面，还有各种错综复杂的页面跳转关系，以及非常坑爹的、问你要下载链接(`package_url`)的部署任务配置。这些东西单独拎出来就有点难以让人接受了，放在一起的时候更是让人摸不着头脑，让满心欢喜来配置CI/CD的你不仅没能成功，还浪费了大把时间，甚至最后发现手动编译、测试和部署更简单更节省时间，以至于开始怀疑CI/CD的意义。

但实际上CI/CD并非如此难用。Github和开源的GitLab大多数时候只需按照步骤编写一个yaml文件就可以使用CI/CD功能，而且有种类多样、功能丰富的插件仓库可以使用，没有让人眼花缭乱的界面、跳转关系、制品仓库。从使用者体验和初学者学习的角度来看，我个人强烈推荐使用Github和GitLab的CI/CD功能，而非华为云。当然，如果要从国产化等政治角度来看的话，当我没说...

希望这份教程能帮到挣扎在华为云CI/CD中的你！

## 1. 集群设置

我们需要为CI/CD配置一个集群用于部署流水线生成的包，按照如下步骤进行：

1. 进入“设置-通用设置-基础资源管理“，新建主机集群

2. 添加或导入已购买的主机（就是买的ECS，在跳出来的界面配置好端口和密码即可）

![](./img/基础资源管理.png)

## 2. 流水线创建

“流水线”即为华为云CI/CD的主要部分，在这一个组件中，我们可以定义从编译、测试到发布的各个过程。需要注意的是编译和发布任务需要分别在“编译构建”和“部署”中定义好之后才能在“流水线”中使用。

1. 新建流水线

![](./img/新建流水线.png)

![](./img/流水线信息.png)

2. 选择构建模版

我用Java写了一个简单的Helloworld Server，使用的是Springboot框架，用Maven构建。因此，在这里我选择使用Maven构建

![](./img/选择构建模版.png)

创建好之后新增一个部署任务，最终我的CI/CD Workflow如下：

![](./img/流水线DAG.png)

3. 定义各个任务

构建任务：具体的业务逻辑需要在“编译构建”中定义，这里我们在构建任务中引用我们创建好的`build-maven`任务，指定好代码仓库。`build-maven`任务的配置过程我们会在[下一章](#3-编译构建)中详细阐述

![](./img/流水线-构建.png)

代码检测任务(Optional)：直接配置即可

![](./img/流水线-代码检查.png)

部署任务：具体的业务逻辑需要在“部署”中定义，这里我们在"Deploy部署"任务中引用我们创建好的`deploy-helloworld`任务，并把"Deploy部署“任务关联到之前的“构建”任务中。中间从`host_group`到`package_name`的一些参数是我们在后续部署过程中需要用到的，具体含义如图所示.在[部署章节](#4-部署)中我们会详细阐述`deploy-helloworld`的配置过程和图中这些参数的含义。

![](./img/流水线-部署.png)

## 3. 编译构建

## 4. 部署

## 5. Q&A

> TODO: Questions from students.